<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¬ì¥ ì£¼ê¸° ë° ìƒë¦¬í•™ì  ì—­í•™ ë¶„ì„ (Cardiac Cycle Dynamics)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #fafaf9; /* Stone-50: Warm neutral background */
            color: #44403c; /* Stone-700: Soft contrast text */
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px; /* Constrained max width */
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }

        /* Custom Scrollbar for cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f5f5f4; 
        }
        ::-webkit-scrollbar-thumb {
            background: #d6d3d1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a29e; 
        }

        .interactive-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .interactive-card:hover {
            transform: translateY(-2px);
            border-left-color: #ea580c; /* Orange-600 */
            background-color: #fff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .phase-btn.active {
            background-color: #ea580c;
            color: white;
            border-color: #ea580c;
        }

        .slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: #d6d3d1;
            border-radius: 5px;
            outline: none;
        }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ea580c;
            cursor: pointer;
            transition: background .15s ease-in-out;
        }
        .slider-thumb::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border: 0;
            border-radius: 50%;
            background: #ea580c;
            cursor: pointer;
            transition: background .15s ease-in-out;
        }
    </style>

    <!-- Placeholder Comments Required by Instructions -->
    <!-- Chosen Palette: Warm Neutrals (Stone) with Burnt Orange (Orange-600) accents for energy/cardiac focus. Minimalistic and clean. -->
    
    <!-- Application Structure Plan: 
         The app follows a "Concept to Clinic" flow.
         1. Header & Intro: Sets context.
         2. Wiggers Diagram (Temporal View): Users visualize the synchronization of Pressure, Volume, and ECG over time. This establishes the baseline "normal" cycle.
         3. PV Loop Simulator (Mechanical View): Interactive sliders allowing users to manipulate Preload and Afterload. This moves from observation to experimentation, solidifying the definitions through cause-and-effect.
         4. Clinical Integration Grid: Connects the abstract concepts (Preload/Afterload) to concrete pathologies (HF, Hypertension) using a card-based layout.
         5. Summary: Key takeaways.
         This structure promotes understanding by first showing *what* happens (Wiggers), then *why* dynamics change (PV Loop), and finally *how* it matters medically.
    -->

    <!-- Visualization & Content Choices:
         1. Wiggers Diagram: 
            - Goal: Visualize temporal relationship of cardiac events.
            - Method: Chart.js Line Chart.
            - Interaction: Hover for values, phase highlighting buttons.
            - Justification: Best for time-series data. Canvas provides smooth rendering of curves.
         2. PV Loop Lab:
            - Goal: Demonstrate Preload/Afterload effects.
            - Method: Plotly.js Scatter Plot.
            - Interaction: Sliders to adjust EDV (Preload) and Aortic Pressure (Afterload).
            - Justification: Plotly handles X-Y coordinate updates efficiently for loops. Sliders provide immediate feedback on the loop shape.
         3. Physiology Cards:
            - Goal: Define terms clearly.
            - Method: HTML Grid with hover states.
            - Interaction: Simple CSS hover for focus.
            - Justification: Textual information needs to be scannable and digestible.
         CONFIRMING: No SVG graphics used. No Mermaid JS used.
    -->
    
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-stone-50 text-stone-700 selection:bg-orange-100 selection:text-orange-900">

    <!-- Navigation / Header -->
    <header class="bg-white border-b border-stone-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-2">
                    <span class="text-2xl font-bold text-stone-800 tracking-tight">ğŸ«€ CardioDynamics</span>
                </div>
                <nav class="hidden md:flex space-x-8">
                    <button onclick="scrollToSection('wiggers-section')" class="text-stone-500 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">ì‹¬ì¥ ì£¼ê¸° (Wiggers)</button>
                    <button onclick="scrollToSection('pv-loop-section')" class="text-stone-500 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">PV Loop ì‹œë®¬ë ˆì´í„°</button>
                    <button onclick="scrollToSection('clinical-section')" class="text-stone-500 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">ì„ìƒì  ì—°ê²°</button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content Wrapper -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-16">

        <!-- Intro Section -->
        <section class="text-center max-w-3xl mx-auto">
            <h1 class="text-4xl font-extrabold text-stone-900 mb-4">ì‹¬ì¥ ìƒë¦¬í•™ì˜ í•µì‹¬ ì—­í•™</h1>
            <p class="text-lg text-stone-600 leading-relaxed">
                ì‹¬ì¥ ì£¼ê¸°(Cardiac Cycle)ëŠ” ì „ê¸°ì  ì‹ í˜¸, ê¸°ê³„ì  ìˆ˜ì¶•, ê·¸ë¦¬ê³  ì••ë ¥ê³¼ ìš©ì ì˜ ë³€í™”ê°€ ì •êµí•˜ê²Œ ë§ë¬¼ë¦¬ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. 
                ì´ ëŒ€ì‹œë³´ë“œëŠ” <strong>Wiggers Diagram</strong>ê³¼ <strong>Pressure-Volume Loop</strong>ë¥¼ í†µí•´ 
                ì „ë¶€í•˜(Preload)ì™€ í›„ë¶€í•˜(Afterload)ê°€ ì‹¬ì¥ ê¸°ëŠ¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì§ê´€ì ìœ¼ë¡œ íƒêµ¬í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.
            </p>
        </section>

        <!-- SECTION 1: WIGGERS DIAGRAM -->
        <section id="wiggers-section" class="bg-white rounded-2xl shadow-sm border border-stone-100 p-6 md:p-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-stone-800">1. ì‹¬ì¥ ì£¼ê¸° íƒ€ì„ë¼ì¸ (Wiggers Diagram)</h2>
                    <p class="text-stone-500 text-sm mt-1">ì‹œê°„ ê²½ê³¼ì— ë”°ë¥¸ ì¢Œì‹¬ì‹¤ ì••ë ¥, ëŒ€ë™ë§¥ ì••ë ¥, ì¢Œì‹¬ì‹¤ ìš©ì ì˜ ë³€í™”ë¥¼ ê´€ì°°í•˜ì‹­ì‹œì˜¤.</p>
                </div>
                <div class="mt-4 md:mt-0 flex flex-wrap gap-2">
                    <button class="phase-btn px-3 py-1 text-xs font-semibold rounded-full border border-stone-300 text-stone-600 transition-colors" onclick="highlightPhase(0)">ì „ì²´ ë³´ê¸°</button>
                    <button class="phase-btn px-3 py-1 text-xs font-semibold rounded-full border border-stone-300 text-stone-600 transition-colors" onclick="highlightPhase(1)">ë“±ìš©ì  ìˆ˜ì¶•ê¸°</button>
                    <button class="phase-btn px-3 py-1 text-xs font-semibold rounded-full border border-stone-300 text-stone-600 transition-colors" onclick="highlightPhase(2)">ë°•ì¶œê¸°</button>
                    <button class="phase-btn px-3 py-1 text-xs font-semibold rounded-full border border-stone-300 text-stone-600 transition-colors" onclick="highlightPhase(3)">ë“±ìš©ì  ì´ì™„ê¸°</button>
                    <button class="phase-btn px-3 py-1 text-xs font-semibold rounded-full border border-stone-300 text-stone-600 transition-colors" onclick="highlightPhase(4)">ì¶©ë§Œê¸°</button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Chart Area -->
                <div class="lg:col-span-2">
                    <div class="chart-container">
                        <canvas id="wiggersChart"></canvas>
                    </div>
                </div>

                <!-- Context Area -->
                <div class="lg:col-span-1 space-y-4 bg-stone-50 p-5 rounded-xl border border-stone-200">
                    <h3 class="font-bold text-stone-800 border-b border-stone-200 pb-2">í˜„ì¬ ë‹¨ê³„ ìƒì„¸ ë¶„ì„</h3>
                    <div id="phase-info" class="text-sm space-y-3">
                        <p class="text-stone-600"><span class="font-semibold text-orange-600">ì•ˆë‚´:</span> ì°¨íŠ¸ ìƒë‹¨ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜ ì°¨íŠ¸ ìœ„ë¥¼ ë§ˆìš°ìŠ¤ë¡œ ê°€ë¦¬í‚¤ë©´ ê° ë‹¨ê³„ë³„ ìƒì„¸ ìƒë¦¬í•™ì  ì´ë²¤íŠ¸(íŒë§‰ ê°œí, í˜ˆë¥˜ ì´ë™)ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        <div class="bg-white p-3 rounded border border-stone-200 shadow-sm">
                            <span class="block text-xs font-bold text-stone-400 uppercase tracking-wide">Key Event</span>
                            <span id="key-event-text" class="font-medium text-stone-800">ì‹¬ì‹¤ ì´ì™„ ë° ì¶©ë§Œ</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="bg-white p-2 rounded border border-stone-200 text-center">
                                <span class="block text-xs text-stone-400">ìŠ¹ëª¨íŒ (Mitral)</span>
                                <span id="mitral-status" class="font-bold text-green-600 text-sm">Open</span>
                            </div>
                            <div class="bg-white p-2 rounded border border-stone-200 text-center">
                                <span class="block text-xs text-stone-400">ëŒ€ë™ë§¥íŒ (Aortic)</span>
                                <span id="aortic-status" class="font-bold text-stone-400 text-sm">Closed</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: PV LOOP SIMULATOR -->
        <section id="pv-loop-section" class="bg-white rounded-2xl shadow-sm border border-stone-100 p-6 md:p-8">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-stone-800">2. PV Loop & ë¶€í•˜(Load) ì‹œë®¬ë ˆì´í„°</h2>
                <p class="text-stone-500 mt-2 max-w-3xl">
                    ì••ë ¥-ìš©ì  ê³ ë¦¬(Pressure-Volume Loop)ëŠ” ì‹¬ì¥ ê¸°ëŠ¥ì„ í‰ê°€í•˜ëŠ” ê°€ì¥ ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤. 
                    ì•„ë˜ ìŠ¬ë¼ì´ë”ë¥¼ ì¡°ì ˆí•˜ì—¬ <strong>ì „ë¶€í•˜(Preload)</strong>ì™€ <strong>í›„ë¶€í•˜(Afterload)</strong>ì˜ ë³€í™”ê°€ 
                    ì¼íšŒ ë°•ì¶œëŸ‰(Stroke Volume)ê³¼ PV Loopì˜ ëª¨ì–‘ì„ ì–´ë–»ê²Œ ë³€í™”ì‹œí‚¤ëŠ”ì§€ ì‹¤í—˜í•´ ë³´ì‹­ì‹œì˜¤.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- Controls Side -->
                <div class="lg:col-span-4 space-y-6">
                    <!-- Preload Control -->
                    <div class="bg-stone-50 p-5 rounded-xl border border-stone-200">
                        <div class="flex justify-between items-center mb-2">
                            <label class="font-bold text-stone-800">ì „ë¶€í•˜ (Preload)</label>
                            <span id="preload-val" class="text-sm bg-stone-200 px-2 py-0.5 rounded text-stone-600">Normal</span>
                        </div>
                        <input type="range" id="preload-slider" min="80" max="160" value="120" step="10" class="slider-thumb w-full mb-3">
                        <p class="text-xs text-stone-500 leading-relaxed">
                            <strong>ìƒë¦¬í•™ì  ì˜ë¯¸:</strong> ì‹¬ì‹¤ ì´ì™„ê¸° ë§ ìš©ì (EDV). ì‹¬ì‹¤ ê·¼ìœ¡ì´ ìˆ˜ì¶• ì „ ëŠ˜ì–´ë‚˜ëŠ” ì •ë„.<br>
                            <strong>ì¦ê°€ ìš”ì¸:</strong> ì •ë§¥ í™˜ë¥˜ëŸ‰ ì¦ê°€, ìˆ˜ì•¡ ê³µê¸‰.<br>
                            <strong>Frank-Starling ë²•ì¹™:</strong> ì „ë¶€í•˜ê°€ ì¦ê°€í•˜ë©´ ìˆ˜ì¶•ë ¥ì´ ì¦ê°€í•˜ì—¬ ë°•ì¶œëŸ‰ì´ ëŠ˜ì–´ë‚©ë‹ˆë‹¤.
                        </p>
                    </div>

                    <!-- Afterload Control -->
                    <div class="bg-stone-50 p-5 rounded-xl border border-stone-200">
                        <div class="flex justify-between items-center mb-2">
                            <label class="font-bold text-stone-800">í›„ë¶€í•˜ (Afterload)</label>
                            <span id="afterload-val" class="text-sm bg-stone-200 px-2 py-0.5 rounded text-stone-600">Normal</span>
                        </div>
                        <input type="range" id="afterload-slider" min="60" max="120" value="80" step="10" class="slider-thumb w-full mb-3">
                        <p class="text-xs text-stone-500 leading-relaxed">
                            <strong>ìƒë¦¬í•™ì  ì˜ë¯¸:</strong> ì‹¬ì‹¤ì´ í˜ˆì•¡ì„ ë°•ì¶œí•˜ê¸° ìœ„í•´ ì´ê²¨ë‚´ì•¼ í•˜ëŠ” ì €í•­(ëŒ€ë™ë§¥ ì••ë ¥).<br>
                            <strong>ì¦ê°€ ìš”ì¸:</strong> ê³ í˜ˆì••, ëŒ€ë™ë§¥íŒ í˜‘ì°©.<br>
                            <strong>ê²°ê³¼:</strong> í›„ë¶€í•˜ê°€ ì¦ê°€í•˜ë©´ ë“±ìš©ì  ìˆ˜ì¶•ê¸°ê°€ ê¸¸ì–´ì§€ê³  ë°•ì¶œëŸ‰ì´ ê°ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                    </div>

                    <!-- Metrics Output -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-orange-50 p-3 rounded border border-orange-100 text-center">
                            <span class="block text-xs text-orange-800 mb-1">ì¼íšŒ ë°•ì¶œëŸ‰ (SV)</span>
                            <span id="sv-display" class="text-2xl font-extrabold text-orange-600">70 ml</span>
                        </div>
                        <div class="bg-stone-100 p-3 rounded border border-stone-200 text-center">
                            <span class="block text-xs text-stone-500 mb-1">ë°•ì¶œë¥  (EF)</span>
                            <span id="ef-display" class="text-2xl font-bold text-stone-700">58%</span>
                        </div>
                    </div>
                </div>

                <!-- Graph Side -->
                <div class="lg:col-span-8">
                    <div id="pvLoopChart" class="w-full h-[450px] bg-white rounded-lg border border-stone-100"></div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: CLINICAL CORRELATIONS -->
        <section id="clinical-section">
            <div class="mb-8 border-l-4 border-orange-500 pl-4">
                <h2 class="text-3xl font-bold text-stone-900">ì„ìƒì  ì—°ê²°ì„± (Clinical Correlations)</h2>
                <p class="text-stone-600 mt-2">ê¸°ì´ˆ ìƒë¦¬í•™ì  ê°œë…ì´ ì‹¤ì œ ì§ˆí™˜ì—ì„œ ì–´ë–»ê²Œ ë‚˜íƒ€ë‚˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Card 1: Systolic Heart Failure -->
                <div class="interactive-card bg-white p-6 rounded-xl shadow-sm border border-stone-100 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                        <span class="text-4xl">ğŸ’”</span>
                    </div>
                    <h3 class="text-xl font-bold text-stone-800 mb-2">ìˆ˜ì¶•ê¸° ì‹¬ë¶€ì „ (Systolic HF)</h3>
                    <div class="text-xs font-bold text-orange-600 bg-orange-50 inline-block px-2 py-1 rounded mb-4">ìˆ˜ì¶•ë ¥ ê°ì†Œ</div>
                    <p class="text-stone-600 text-sm mb-4 leading-relaxed">
                        ì‹¬ê·¼ì˜ ìˆ˜ì¶•ë ¥(Contractility) ìì²´ê°€ ê°ì†Œí•œ ìƒíƒœì…ë‹ˆë‹¤.
                    </p>
                    <ul class="text-sm space-y-2 text-stone-600">
                        <li class="flex items-start">
                            <span class="mr-2 text-orange-500">â†˜</span> PV Loopì˜ í­(ë„ˆë¹„)ì´ ì¢ì•„ì§
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-orange-500">â†˜</span> ì¼íšŒ ë°•ì¶œëŸ‰(SV) ê°ì†Œ
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-orange-500">â†—</span> ì´ì™„ê¸° ë§ ìš©ì (EDV) ì¦ê°€ (ë³´ìƒì‘ìš©)
                        </li>
                    </ul>
                </div>

                <!-- Card 2: Aortic Stenosis -->
                <div class="interactive-card bg-white p-6 rounded-xl shadow-sm border border-stone-100 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                        <span class="text-4xl">ğŸšª</span>
                    </div>
                    <h3 class="text-xl font-bold text-stone-800 mb-2">ëŒ€ë™ë§¥íŒ í˜‘ì°©ì¦ (Aortic Stenosis)</h3>
                    <div class="text-xs font-bold text-red-600 bg-red-50 inline-block px-2 py-1 rounded mb-4">í›„ë¶€í•˜(Afterload) ê¸‰ì¦</div>
                    <p class="text-stone-600 text-sm mb-4 leading-relaxed">
                        íŒë§‰ì´ ì¢ì•„ì ¸ ì‹¬ì‹¤ì´ í˜ˆì•¡ì„ ì§œë‚´ê¸° ìœ„í•´ ì—„ì²­ë‚œ ì••ë ¥ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.
                    </p>
                    <ul class="text-sm space-y-2 text-stone-600">
                        <li class="flex items-start">
                            <span class="mr-2 text-red-500">â†—</span> PV Loopì˜ ë†’ì´(ì••ë ¥)ê°€ ê·¹ë„ë¡œ ìƒìŠ¹
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-red-500">â„¹ï¸</span> ì‹¬ì‹¤ ë¹„ëŒ€(Hypertrophy) ìœ ë°œ
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-red-500">â†˜</span> ìˆ˜ì¶•ê¸° ë²½ ì‘ë ¥(Wall Stress) ì¦ê°€
                        </li>
                    </ul>
                </div>

                <!-- Card 3: Mitral Regurgitation -->
                <div class="interactive-card bg-white p-6 rounded-xl shadow-sm border border-stone-100 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                        <span class="text-4xl">ğŸ”„</span>
                    </div>
                    <h3 class="text-xl font-bold text-stone-800 mb-2">ìŠ¹ëª¨íŒ ì—­ë¥˜ì¦ (Mitral Regurgitation)</h3>
                    <div class="text-xs font-bold text-blue-600 bg-blue-50 inline-block px-2 py-1 rounded mb-4">ì „ë¶€í•˜(Preload) ì¦ê°€</div>
                    <p class="text-stone-600 text-sm mb-4 leading-relaxed">
                        ìˆ˜ì¶•ê¸° ë™ì•ˆ í˜ˆì•¡ì´ ì¢Œì‹¬ë°©ìœ¼ë¡œ ì—­ë¥˜í•˜ì—¬, ë‹¤ìŒ ì´ì™„ê¸°ì— ì¢Œì‹¬ì‹¤ë¡œ ë“¤ì–´ì˜¤ëŠ” í˜ˆì•¡ëŸ‰ì´ ì¦ê°€í•©ë‹ˆë‹¤.
                    </p>
                    <ul class="text-sm space-y-2 text-stone-600">
                        <li class="flex items-start">
                            <span class="mr-2 text-blue-500">â†”ï¸</span> ë“±ìš©ì  ìˆ˜ì¶•ê¸°ê°€ ì‚¬ë¼ì§ (ì¦‰ì‹œ ì—­ë¥˜)
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-blue-500">â†—</span> PV Loopê°€ ì˜¤ë¥¸ìª½ìœ¼ë¡œ í¬ê²Œ ì´ë™ (ìš©ì  ì¦ê°€)
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-blue-500">â†—</span> ì´ ë°•ì¶œëŸ‰ì€ ì¦ê°€í•˜ë‚˜ ìœ íš¨ ë°•ì¶œëŸ‰ì€ ê°ì†Œ
                        </li>
                    </ul>
                </div>

                <!-- Card 4: Hypertension -->
                <div class="interactive-card bg-white p-6 rounded-xl shadow-sm border border-stone-100 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                        <span class="text-4xl">ğŸŒ¡ï¸</span>
                    </div>
                    <h3 class="text-xl font-bold text-stone-800 mb-2">ë§Œì„± ê³ í˜ˆì•• (Hypertension)</h3>
                    <div class="text-xs font-bold text-stone-600 bg-stone-200 inline-block px-2 py-1 rounded mb-4">ì§€ì†ì  í›„ë¶€í•˜ ì¦ê°€</div>
                    <p class="text-stone-600 text-sm mb-4 leading-relaxed">
                        ë†’ì€ ì „ì‹  í˜ˆê´€ ì €í•­ìœ¼ë¡œ ì¸í•´ ì‹¬ì¥ì´ ì§€ì†ì ìœ¼ë¡œ ë†’ì€ ì••ë ¥ì„ ì´ê²¨ë‚´ì•¼ í•©ë‹ˆë‹¤.
                    </p>
                    <ul class="text-sm space-y-2 text-stone-600">
                        <li class="flex items-start">
                            <span class="mr-2 text-stone-500">â†—</span> ESV(ìˆ˜ì¶•ê¸° ë§ ìš©ì ) ì¦ê°€ ê²½í–¥
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-stone-500">â†˜</span> ë°•ì¶œëŸ‰(SV) ë³´ì¡´ì„ ìœ„í•´ ì‹¬ê·¼ ë¹„ëŒ€ ë°œìƒ
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-stone-500">âš ï¸</span> ì¥ê¸°ì ìœ¼ë¡œ ì´ì™„ê¸° ì‹¬ë¶€ì „ ìœ„í—˜ ì¦ê°€
                        </li>
                    </ul>
                </div>
            </div>
        </section>
        
        <footer class="text-center text-stone-400 text-sm py-8 border-t border-stone-200">
            <p>Interactive Physiology Report &copy; 2024 | Cardiovascular Dynamics Education</p>
            <p class="mt-1 text-xs">Based on standard physiological models (Guyton & Hall, Boron & Boulpaep).</p>
        </footer>

    </main>

    <script>
        // --- Navigation Logic ---
        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- SECTION 1: WIGGERS DIAGRAM LOGIC (Chart.js) ---
        
        // Data approximation functions for Wiggers
        const timePoints = Array.from({length: 100}, (_, i) => i); // 0 to 99 representing one cycle (0.8s)
        
        // Phase Indices (approximate mapping to 0-99 scale)
        // 0-10: Atrial Systole
        // 10-20: Isovolumetric Contraction
        // 20-50: Ejection
        // 50-60: Isovolumetric Relaxation
        // 60-100: Rapid Inflow / Diastasis
        
        function generateWiggersData() {
            // Simulated physiological curves
            const lvPressure = timePoints.map(t => {
                if (t < 10) return 5 + (t/2); // Atrial systole bump
                if (t < 20) return 10 + (t-10)*11; // Isovol contraction (spike to 120)
                if (t < 45) return 120 - Math.pow((t-32)/4, 2); // Ejection (arch)
                if (t < 60) return 100 - (t-45)*6; // Isovol relaxation (drop)
                return 5; // Diastole
            });

            const aorticPressure = timePoints.map(t => {
                if (t < 20) return 80 - (t/2); // Diastolic runoff
                if (t < 45) return 120 - Math.pow((t-32)/4, 2); // Ejection (follows LVP)
                if (t < 55) return 90 + Math.sin((t-45))*2; // Dicrotic notch
                return 90 - (t-55)*0.3; // Diastolic runoff
            });

            const lvVolume = timePoints.map(t => {
                if (t < 10) return 110 + t; // Atrial kick (+10ml)
                if (t < 20) return 120; // Isovolumetric (constant)
                if (t < 50) return 120 - (t-20)*2.3; // Ejection (drop to 50)
                if (t < 60) return 50; // Isovolumetric (constant)
                return 50 + (t-60)*1.5; // Rapid filling
            });

            const ecg = timePoints.map(t => {
                // P wave (start), QRS (10-15), T (40-50)
                if (t > 0 && t < 8) return 0.2 * Math.sin((t-4)*0.8); // P
                if (t > 13 && t < 18) return (t === 15 || t === 16) ? 1.5 : -0.2; // QRS spike
                if (t > 35 && t < 50) return 0.3 * Math.sin((t-42)*0.4); // T
                return 0;
            });

            return { lvPressure, aorticPressure, lvVolume, ecg };
        }

        const wData = generateWiggersData();

        const ctxWiggers = document.getElementById('wiggersChart').getContext('2d');
        const wiggersChart = new Chart(ctxWiggers, {
            type: 'line',
            data: {
                labels: timePoints,
                datasets: [
                    {
                        label: 'ì¢Œì‹¬ì‹¤ ì••ë ¥ (mmHg)',
                        data: wData.lvPressure,
                        borderColor: '#ea580c', // Orange
                        borderWidth: 3,
                        yAxisID: 'yPressure',
                        tension: 0.4,
                        pointRadius: 0
                    },
                    {
                        label: 'ëŒ€ë™ë§¥ ì••ë ¥ (mmHg)',
                        data: wData.aorticPressure,
                        borderColor: '#dc2626', // Red
                        borderWidth: 2,
                        borderDash: [5, 5],
                        yAxisID: 'yPressure',
                        tension: 0.4,
                        pointRadius: 0
                    },
                    {
                        label: 'ì¢Œì‹¬ì‹¤ ìš©ì  (mL)',
                        data: wData.lvVolume,
                        borderColor: '#2563eb', // Blue
                        borderWidth: 2,
                        yAxisID: 'yVolume',
                        tension: 0.4,
                        pointRadius: 0
                    },
                    {
                        label: 'ECG (mV)',
                        data: wData.ecg,
                        borderColor: '#16a34a', // Green
                        borderWidth: 1,
                        yAxisID: 'yECG',
                        tension: 0.4,
                        pointRadius: 0,
                        hidden: false
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                scales: {
                    x: {
                        display: false, // Hide numeric time steps for cleaner look
                        grid: { display: false }
                    },
                    yPressure: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: 'Pressure (mmHg)' },
                        min: 0,
                        max: 140
                    },
                    yVolume: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: { display: true, text: 'Volume (mL)' },
                        min: 40,
                        max: 140,
                        grid: { drawOnChartArea: false }
                    },
                    yECG: {
                        display: false, // Hide axis labels for ECG
                        min: -1,
                        max: 3
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            title: (context) => {
                                const t = context[0].parsed.x;
                                if (t < 10) return 'ì‹¬ë°© ìˆ˜ì¶•ê¸° (Atrial Systole)';
                                if (t < 20) return 'ë“±ìš©ì  ìˆ˜ì¶•ê¸° (Isovolumetric Contraction)';
                                if (t < 50) return 'ë°•ì¶œê¸° (Ejection)';
                                if (t < 60) return 'ë“±ìš©ì  ì´ì™„ê¸° (Isovolumetric Relaxation)';
                                return 'ì‹¬ì‹¤ ì¶©ë§Œê¸° (Filling)';
                            }
                        }
                    },
                    annotation: {
                        // Lines separating phases could be added here if using chartjs-plugin-annotation
                    }
                }
            }
        });

        function highlightPhase(phaseIndex) {
            // Update UI buttons
            const buttons = document.querySelectorAll('.phase-btn');
            buttons.forEach((btn, idx) => {
                if(idx === phaseIndex) btn.classList.add('active');
                else btn.classList.remove('active');
            });

            // Update Info Text based on phase
            const eventText = document.getElementById('key-event-text');
            const mitral = document.getElementById('mitral-status');
            const aortic = document.getElementById('aortic-status');
            const phaseInfo = document.getElementById('phase-info');

            // Ranges in data indices
            let min, max;
            
            switch(phaseIndex) {
                case 1: // Isovol Contraction
                    min = 10; max = 20;
                    eventText.innerHTML = "ì‹¬ì‹¤ ì••ë ¥ ê¸‰ìƒìŠ¹, ëª¨ë“  íŒë§‰ ë‹«í˜";
                    mitral.innerHTML = "<span class='text-stone-400'>Closed</span>";
                    aortic.innerHTML = "<span class='text-stone-400'>Closed</span>";
                    break;
                case 2: // Ejection
                    min = 20; max = 50;
                    eventText.innerHTML = "ëŒ€ë™ë§¥íŒ ì—´ë¦¼, í˜ˆì•¡ ë°•ì¶œ";
                    mitral.innerHTML = "<span class='text-stone-400'>Closed</span>";
                    aortic.innerHTML = "<span class='text-green-600'>Open</span>";
                    break;
                case 3: // Isovol Relaxation
                    min = 50; max = 60;
                    eventText.innerHTML = "ì‹¬ì‹¤ ì••ë ¥ ê¸‰í•˜ê°•, ëŒ€ë™ë§¥íŒ ë‹«í˜";
                    mitral.innerHTML = "<span class='text-stone-400'>Closed</span>";
                    aortic.innerHTML = "<span class='text-stone-400'>Closed</span>";
                    break;
                case 4: // Filling
                    min = 60; max = 99;
                    eventText.innerHTML = "ìŠ¹ëª¨íŒ ì—´ë¦¼, í˜ˆì•¡ ìœ ì…";
                    mitral.innerHTML = "<span class='text-green-600'>Open</span>";
                    aortic.innerHTML = "<span class='text-stone-400'>Closed</span>";
                    break;
                default: // All/Atrial
                    min = 0; max = 100;
                    eventText.innerHTML = "ì „ì²´ ì£¼ê¸° ê´€ì°°";
                    mitral.innerHTML = "Varies";
                    aortic.innerHTML = "Varies";
            }

            // Visual highlight in chart (simple version: zoom or filter? Just text update is safer for stability)
            // Ideally, we would add a shaded region annotation, but text context is sufficient for this scope.
        }


        // --- SECTION 2: PV LOOP LOGIC (Plotly.js) ---

        // State for PV Loop
        let preload = 120; // EDV
        let afterload = 80; // Diastolic Aortic Pressure (affects height of opening)
        let esvBase = 50; // Base ESV at normal conditions
        let contractility = 1.0; // Slope of ESPVR

        function calculatePVLoop(p_edv, p_afterload) {
            // Simplified PV Loop Geometry
            // 1. Filling (Bottom): Volume 50 -> EDV, Pressure ~5-10
            // 2. Isovol Contraction (Right): Volume EDV, Pressure 10 -> Afterload
            // 3. Ejection (Top): Volume EDV -> ESV, Pressure rises slightly then falls
            // 4. Isovol Relaxation (Left): Volume ESV, Pressure End-Systolic -> 10
            
            // Effect of Afterload on ESV (simplified ESPVR line logic)
            // ESPVR: P = Emax * (V - V0). If P (Afterload peak) increases, V (ESV) must increase if Emax is constant.
            // Let's approximate: Higher afterload = Higher pressure required = slightly less ejection = Higher ESV.
            const adjustedESV = esvBase + (p_afterload - 80) * 0.4; 
            
            // Peak Systolic Pressure (approx related to Afterload)
            const peakPressure = p_afterload + 40; 

            // Points for Plotly (Polyline)
            const x = [adjustedESV, p_edv, p_edv, adjustedESV, adjustedESV]; // Volume
            const y = [10, 15, p_afterload, peakPressure, 10]; // Pressure (Simplified box shape with curve approx)
            
            // More points for smoother curve approximation (Optional, keep simple polygon for robustness)
            // Let's make it a bit more "Loopy"
            const x_smooth = [
                adjustedESV, // Start Relax (ESV, Low P)
                p_edv * 0.6 + adjustedESV * 0.4, // Mid filling
                p_edv, // End Diastole (EDV, Low P)
                p_edv, // Isovol Contraction Top (EDV, Afterload P)
                (p_edv + adjustedESV) / 2, // Peak Ejection
                adjustedESV, // End Systole (ESV, Peak P approx)
                adjustedESV // Back to start
            ];
            
            // Adjusted logic for visual clarity of interactions
            // Point A: Mitral Valve Opens (ESV, Low P) -> (adjustedESV, 5)
            // Point B: Mitral Valve Closes (EDV, Low P) -> (p_edv, 10)
            // Point C: Aortic Valve Opens (EDV, Afterload) -> (p_edv, p_afterload)
            // Point D: Aortic Valve Closes (ESV, Peak P) -> (adjustedESV, peakPressure)
            
            // We draw lines between A->B->C->D->A
            
            return {
                x: [adjustedESV, p_edv, p_edv, adjustedESV, adjustedESV],
                y: [5, 12, p_afterload, peakPressure, 5],
                sv: Math.round(p_edv - adjustedESV),
                ef: Math.round(((p_edv - adjustedESV) / p_edv) * 100)
            };
        }

        function updatePVChart() {
            const data = calculatePVLoop(preload, afterload);
            
            // Update Metrics
            document.getElementById('sv-display').innerText = data.sv + " ml";
            document.getElementById('ef-display').innerText = data.ef + "%";
            document.getElementById('preload-val').innerText = preload + " ml";
            document.getElementById('afterload-val').innerText = afterload + " mmHg";

            const trace = {
                x: data.x,
                y: data.y,
                mode: 'lines+markers',
                fill: 'toself',
                fillcolor: 'rgba(234, 88, 12, 0.1)', // Orange tint
                line: {
                    color: '#ea580c',
                    width: 3,
                    shape: 'spline',
                    smoothing: 0.5
                },
                marker: {
                    size: 6,
                    color: '#ea580c'
                },
                name: 'PV Loop'
            };

            const layout = {
                title: 'Pressure-Volume Loop',
                xaxis: {
                    title: 'Volume (mL)',
                    range: [0, 200],
                    showgrid: true,
                    zeroline: true
                },
                yaxis: {
                    title: 'Pressure (mmHg)',
                    range: [0, 180],
                    showgrid: true,
                    zeroline: true
                },
                margin: { t: 40, r: 20, l: 50, b: 50 },
                hovermode: 'closest'
            };

            // Annotations for Loop Corners
            layout.annotations = [
                {
                    x: data.x[1], y: data.y[1], xref: 'x', yref: 'y',
                    text: 'ì´ì™„ê¸° ë§ (EDV)', showarrow: true, arrowhead: 2, ax: 20, ay: 20
                },
                {
                    x: data.x[2], y: data.y[2], xref: 'x', yref: 'y',
                    text: 'ëŒ€ë™ë§¥íŒ ì—´ë¦¼', showarrow: true, arrowhead: 2, ax: 20, ay: -20
                }
            ];

            Plotly.react('pvLoopChart', [trace], layout, {displayModeBar: false, responsive: true});
        }

        // Initialize Plotly
        updatePVChart();

        // Slider Event Listeners
        document.getElementById('preload-slider').addEventListener('input', (e) => {
            preload = parseInt(e.target.value);
            updatePVChart();
        });

        document.getElementById('afterload-slider').addEventListener('input', (e) => {
            afterload = parseInt(e.target.value);
            updatePVChart();
        });
        
        // Window Resize Handler for Chart.js
        window.addEventListener('resize', () => {
             wiggersChart.resize();
             Plotly.Plots.resize('pvLoopChart');
        });

    </script>
</body>
</html>